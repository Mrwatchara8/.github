
## Hi there 👋
<div align="center">
  <img src="assets/davevad93.gif" width=875>
  <hr>
  <a href="https://github.com/davevad93"><img src="https://komarev.com/ghpvc/?username=davevad93&color=brightgreen&style=for-the-badge"/><a/>
  <a href="./LICENSE"><img src="https://img.shields.io/github/license/davevad93/davevad93?style=for-the-badge&color=brightgreen"/></a>
  <a href=README.it.md><img src="assets/it.svg" width=190></a>
  <a href=README.es.md><img src="assets/es.svg" width=188></a>
  <hr>
  <p align="center"><a href="https://github.com/ryo-ma/github-profile-trophy"><img src="https://github-profile-trophy-davevad93s-projects.vercel.app/?username=davevad93&theme=matrix&rank=-B&column=-1" alt="davevad93"/></a></p>
</div>  

<hr>

<div align="center">
      <a href="https://git.io/typing-svg"><img src="https://readme-typing-svg.herokuapp.com?font=Fira+Code&size=28&duration=7000&pause=1000&color=00FF2B&center=true&vCenter=true&repeat=false&random=false&width=1000&lines=About+me%3A" alt="Typing SVG"/></a>
      <a href="https://git.io/typing-svg"><img src="https://readme-typing-svg.herokuapp.com?font=Fira+Code&size=15&pause=1000&color=00FF2B&center=true&vCenter=true&multiline=true&repeat=false&random=false&width=950&height=75&lines=Former+DJ,+now+fullstack+developer.+Huge+heavy+metal+and+all+pre-2000s+music+fan,+history+nerd.;“Those+who+cannot+remember+the+past+are+condemned+to+repeat+it”." alt="Typing SVG" /></a>

  <details>
    <summary><a href="https://git.io/typing-svg"><img src="https://readme-typing-svg.demolab.com?font=Fira+Code&pause=1000&color=00FF2B&center=true&vCenter=true&multiline=true&repeat=false&random=false&width=850&lines=Top+Repositories:" alt="Typing SVG" /></a></summary>
    
  <!--START_SECTION:top_repos-->
| 📁 Repository | ⭐ Stars | 🔱 Forks |
| --- | --- | --- |
| [davevad93](https://github.com/davevad93/davevad93) | 47 | 21 |
| [rest-countries-django-app](https://github.com/davevad93/rest-countries-django-app) | 19 | 6 |
| [pass-gen](https://github.com/davevad93/pass-gen) | 12 | 6 |
| [drawdb](https://github.com/davevad93/drawdb) | 11 | 0 |
| [20_21_UT2-Actividades-3](https://github.com/davevad93/20_21_UT2-Actividades-3) | 8 | 0 |
<!--END_SECTION:top_repos-->
  
  </details>

  <details>
    <summary><a href="https://git.io/typing-svg"><img src="https://readme-typing-svg.demolab.com?font=Fira+Code&pause=1000&color=00FF2B&center=true&vCenter=true&multiline=true&repeat=false&random=false&width=850&lines=Recent+GitHub+Activity:" alt="Typing SVG" /></a></summary>
    
  <!--START_SECTION:activity-->
| Recent Activity |
| --- |
❌ Closed PR [#121](https://github.com/davevad93/pass-gen/pull/121) in [davevad93/pass-gen](https://github.com/davevad93/pass-gen/pull/121)
⬆️ Pushed [2 commit(s)](https://github.com/davevad93/pass-gen/commits) to [davevad93/pass-gen](https://github.com/davevad93/pass-gen)
✔️ Merged PR [#120](https://github.com/davevad93/pass-gen/pull/120) in [davevad93/pass-gen](https://github.com/davevad93/pass-gen/pull/120)
🔍 Reviewed PR [#120](https://github.com/davevad93/pass-gen/pull/120) in [davevad93/pass-gen](https://github.com/davevad93/pass-gen/pull/120)
⬆️ Pushed [2 commit(s)](https://github.com/davevad93/pass-gen/commits) to [davevad93/pass-gen](https://github.com/davevad93/pass-gen)
✔️ Merged PR [#119](https://github.com/davevad93/pass-gen/pull/119) in [davevad93/pass-gen](https://github.com/davevad93/pass-gen/pull/119)
🔍 Reviewed PR [#119](https://github.com/davevad93/pass-gen/pull/119) in [davevad93/pass-gen](https://github.com/davevad93/pass-gen/pull/119)
⬆️ Pushed [12 commit(s)](https://github.com/davevad93/YuE/commits) to [davevad93/YuE](https://github.com/davevad93/YuE)
⬆️ Pushed [2 commit(s)](https://github.com/davevad93/pass-gen/commits) to [davevad93/pass-gen](https://github.com/davevad93/pass-gen)
✔️ Merged PR [#118](https://github.com/davevad93/pass-gen/pull/118) in [davevad93/pass-gen](https://github.com/davevad93/pass-gen/pull/118)
🔍 Reviewed PR [#118](https://github.com/davevad93/pass-gen/pull/118) in [davevad93/pass-gen](https://github.com/davevad93/pass-gen/pull/118)
⬆️ Pushed [20 commit(s)](https://github.com/davevad93/jan/commits) to [davevad93/jan](https://github.com/davevad93/jan)
📣 Commented on issue [#29](https://github.com/davevad93/davevad93/issues/29#issuecomment-3067053989) in [davevad93/davevad93](https://github.com/davevad93/davevad93/issues/29#issuecomment-3067053989)
📣 Commented on issue [#29](https://github.com/davevad93/davevad93/issues/29#issuecomment-3063964544) in [davevad93/davevad93](https://github.com/davevad93/davevad93/issues/29#issuecomment-3063964544)
❌ Closed PR [#116](https://github.com/davevad93/pass-gen/pull/116) in [davevad93/pass-gen](https://github.com/davevad93/pass-gen/pull/116)
<!--END_SECTION:activity-->
  
  </details>
</div>

<hr>

| [![Typing SVG](https://readme-typing-svg.herokuapp.com?font=Fira+Code&size=25&pause=1000&color=00FF2B&center=true&vCenter=true&repeat=false&random=false&width=300&lines=Languages)](https://git.io/typing-svg) | [![Typing SVG](https://readme-typing-svg.herokuapp.com?font=Fira+Code&size=25&pause=1000&color=00FF2B&center=true&vCenter=true&repeat=false&random=false&width=200&lines=Frameworks)](https://git.io/typing-svg) | [![Typing SVG](https://readme-typing-svg.herokuapp.com?font=Fira+Code&size=25&pause=1000&color=00FF2B&center=true&vCenter=true&repeat=false&random=false&width=200&lines=IDEs)](https://git.io/typing-svg) | [![Typing SVG](https://readme-typing-svg.herokuapp.com?font=Fira+Code&size=25&pause=1000&color=00FF2B&center=true&vCenter=true&repeat=false&random=false&width=200&lines=Tools)](https://git.io/typing-svg) | [![Typing SVG](https://readme-typing-svg.herokuapp.com?font=Fira+Code&size=25&pause=1000&color=00FF2B&center=true&vCenter=true&repeat=false&random=false&width=300&lines=Operating+Systems)](https://git.io/typing-svg) |
| ----- | ---- | ---- | ---- | ---- |
| <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=py,cs,java" title="Python, C#, Java"/></a></div> | <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=django,flask" title="Django, Flask"/></a></div>| <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=visualstudio" title="Visual Studio"/></a></div> | <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=git,github" title="Git, GitHub"/></a></div> | <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=windows" title="Windows"/></a></div> |
| <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=js,html,css" title="JavaScript, HTML, CSS"/></a></div> | <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=dotnet,nodejs" title=".NET, Node.js"/></a></div> | <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=vscode" title="VS Code"/></a></div> | <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=anaconda" title="Anaconda"/></a></div> | <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=linux" title="Linux"/></a></div> |
| <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=r,mysql,sqlite" title="R, MySQL, SQLite"/></a></div> | <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=bootstrap,react" title="Bootstrap, React"/></a></div> | <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=eclipse" title="Eclipse"/></a></div> | <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=ableton" title="Ableton"/></a></div> | <div align="center"><a href="https://skillicons.dev"><img src="https://skillicons.dev/icons?i=ubuntu" title="Ubuntu"/></a></div> | 
     
<hr>

<div align="center">
  <a href="https://github.com/anuraghazra/github-readme-stats"><img src="https://github-readme-stats-davevad93s-projects.vercel.app/api/top-langs?username=davevad93&show_icons=true&locale=en&layout=compact&langs_count=16&title_color=00FF2B&text_color=00FF2B&border_color=00FF2B&theme=chartreuse-dark" alt="davevad93" width=460 /></a>
  <br>
  <a href="https://github.com/anuraghazra/github-readme-stats"><img src="https://github-readme-stats-davevad93s-projects.vercel.app/api?username=davevad93&show_icons=true&locale=en&title_color=00FF2B&text_color=00FF2B&icon_color=00FF2B&border_color=00FF2B&theme=chartreuse-dark&show=discussions_answered,prs_merged,reviews&include_all_commits=true" alt="davevad93" width=460 /></a>
  <br>
  <a href="https://github.com/DenverCoder1/github-readme-streak-stats"><img src="https://github-readme-streak-stats-davevad93s-projects.vercel.app/?user=davevad93&&border=00FF2B&stroke=00FF2B&ring=00FF2B&fire=00FF2B&currStreakNum=00FF2B&sideNums=00FF2B&currStreakLabel=00FF2B&sideLabels=00FF2B&dates=00FF2B&theme=chartreuse-dark" alt="davevad93" width=460 /></a>
</div>

[![Davide's GitHub activity graph](https://github-readme-activity-graph.vercel.app/graph?username=davevad93&theme=github-compact&bg_color=000000&line=009A22&point=98FB98&color=00FF2B&title_color=00FF2B&area=true)](https://github.com/ashutosh00710/github-readme-activity-graph)

<div align="center">
      <a href="https://git.io/typing-svg"><img src="https://readme-typing-svg.herokuapp.com?font=Fira+Code&size=28&duration=7000&pause=1000&color=00FF2B&center=true&vCenter=true&repeat=false&random=false&width=1000&lines=Top+followers%3A" alt="Typing SVG"/></a>
<!--START_SECTION:followers-->
<table>
  <tr><td align="center">
  <a href="https://github.com/wcervini">
    <img src="https://avatars.githubusercontent.com/u/51060" width="75px" alt="wcervini" />
    <br />
    <sub>wcervini</sub>
  </a>
</td>
<td align="center">
  <a href="https://github.com/josemle">
    <img src="https://avatars.githubusercontent.com/u/1214313" width="75px" alt="josemle" />
    <br />
    <sub>josemle</sub>
  </a>
</td>
<td align="center">
  <a href="https://github.com/juanpflores">
    <img src="https://avatars.githubusercontent.com/u/6200135" width="75px" alt="juanpflores" />
    <br />
    <sub>juanpflores</sub>
  </a>
</td>
<td align="center">
  <a href="https://github.com/HeedongKang">
    <img src="https://avatars.githubusercontent.com/u/6754440" width="75px" alt="HeedongKang" />
    <br />
    <sub>HeedongKang</sub>
  </a>
</td>
<td align="center">
  <a href="https://github.com/alexrosepizant">
    <img src="https://avatars.githubusercontent.com/u/7753376" width="75px" alt="alexrosepizant" />
    <br />
    <sub>alexrosepizant</sub>
  </a>
</td>
<td align="center">
  <a href="https://github.com/rationality23">
    <img src="https://avatars.githubusercontent.com/u/11854131" width="75px" alt="rationality23" />
    <br />
    <sub>rationality23</sub>
  </a>
</td>
<td align="center">
  <a href="https://github.com/diegovalemoreno">
    <img src="https://avatars.githubusercontent.com/u/15755827" width="75px" alt="diegovalemoreno" />
    <br />
    <sub>diegovalemoreno</sub>
  </a>
</td>
</tr>
<tr><td align="center">
  <a href="https://github.com/waterfire-source">
    <img src="https://avatars.githubusercontent.com/u/16292334" width="75px" alt="waterfire-source" />
    <br />
    <sub>waterfire-source</sub>
  </a>
</td>
<td align="center">
  <a href="https://github.com/Neelka96">
    <img src="https://avatars.githubusercontent.com/u/20176164" width="75px" alt="Neelka96" />
    <br />
    <sub>Neelka96</sub>
  </a>
</td>
<td align="center">
  <a href="https://github.com/andrejmoltok">
    <img src="https://avatars.githubusercontent.com/u/20362038" width="75px" alt="andrejmoltok" />
    <br />
    <sub>andrejmoltok</sub>
  </a>
</td>
<td align="center">
  <a href="https://github.com/djvelimir">
    <img src="https://avatars.githubusercontent.com/u/20823832" width="75px" alt="djvelimir" />
    <br />
    <sub>djvelimir</sub>
  </a>
</td>
<td align="center">
  <a href="https://github.com/nguyenhoanghai1605">
    <img src="https://avatars.githubusercontent.com/u/21367266" width="75px" alt="nguyenhoanghai1605" />
    <br />
    <sub>nguyenhoanghai1605</sub>
  </a>
</td>
<td align="center">
  <a href="https://github.com/Abimomin">
    <img src="https://avatars.githubusercontent.com/u/22491475" width="75px" alt="Abimomin" />
    <br />
    <sub>Abimomin</sub>
  </a>
</td>
<td align="center">
  <a href="https://github.com/riadnwu">
    <img src="https://avatars.githubusercontent.com/u/29239672" width="75px" alt="riadnwu" />
    <br />
    <sub>riadnwu</sub>
  </a>
</td>
</tr>
</table>

<!--END_SECTION:followers-->

<!--
**davevad93/davevad93** is a ✨ _special_ ✨ repository because its `README.md` (this file) appears on your GitHub profile.

Here are some ideas to get you started:

- 🔭 I’m currently working on ...
- 🌱 I’m currently learning ...
- 👯 I’m looking to collaborate on ...
- 🤔 I’m looking for help with ...
- 💬 Ask me about ...
- 📫 How to reach me: ...
- 😄 Pronouns: ...
- ⚡ Fun fact: ...
-->

<!--

**Here are some ideas to get you started:**

🙋‍♀️ A short introduction - what is your organization all about?
🌈 Contribution guidelines - how can the community get involved?
👩‍💻 Useful resources - where can the community find your docs? Is there anything else the community should know?
🍿 Fun facts - what does your team eat for breakfast?
🧙 Remember, you can do mighty things with the power of [Markdown](https://docs.github.com/github/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax)
-->https://github.com/youniform-gitdi/.github/tree/d7b53c96d1c11e83f8708dcf199e693f23eff66a/profile

Uploading 1000001662.mp4…


![1000002525](https://github.com/user-attachments/assets/164b41bc-785c-429d-9c2f-cb43c7cd2bd0)
https://github.com/organizations/youniform-gitdi/settings/profilelibrary(zoo)
library(tseries)
library(lmtest)
library(forecast)
library(ggplot2)
library(patchwork)

# Correction Q1 à 3 disponible https://github.com/AQLT/TP_Ensae2A/wiki

##########################
####### Question 1 #######
##########################
data <-read.csv("Data/data_tp5.csv",sep = ";")
data$dates[1] 
spread <- ts(data$spread, start = c(1986, 3), frequency = 12)
dspread <- diff(spread,1) # difference premiere


##########################
####### Question 2 #######
##########################
plot(cbind(spread,dspread))
# La série en niveau semble avoir une tendance déterministe (ou deux tendances)
# La série différenciée pourrait être stationnaire


##########################
####### Question 3 #######
##########################

# rmq : tester la présence d'une tendance par régression n'a pas de sens
# car si on a une racine unitaire on est dans le cas d'une spurious régression
y = cumsum(rnorm(n=100))
summary(lm(y ~ seq_along(y)))

library(urca)
library(fUnitRoots)
# Ici on teste la présence de racine unitaire
# adf invalid si on ne rajoute pas de variable explicative
# dans le doute c'est toujours mieux de rajouter la tendance et constante
adf <- adfTest(spread, type = "ct",lags = 0)

Qtests <- function(series, k = 24, fitdf=0) {
  t(sapply(1:k,function(l){
    if(l <= fitdf){
      b <- list(statistic = NA, p.value = NA)
    }else{
      b <- Box.test(series,"Ljung-Box",lag = l,
                    fitdf = fitdf
      )
    }
    data.frame(lag = l,
               b$statistic,
               b$p.value
    )
  }))
}
adfTest_valid <- function(series,kmax,type){
  k <- 0
  # On test ADF jusqu'à ce que les résidus ne soient pas autocorrélés
  noautocorr <- 0
  while (noautocorr==0){
    cat(paste0("ADF with ",k, " lags: residuals OK? "))
    adf <- adfTest(series,lags=k,type=type)
    pvals <- Qtests(adf@test$lm$residuals,
                    24,
                    fitdf=length(adf@test$lm$coefficients))[,3]
    if (sum(pvals<0.05,na.rm=T) == 0) {
      noautocorr <- 1; cat("OK \n")
    }else {
      cat("nope \n")
    }
    k <- k + 1
  }
  return(adf)
}

# On ne fait que le test à l'ordre 24
adfTest_valid2 <- function(series,kmax,type){
  k <- 0
  # On test ADF jusqu'à ce que les résidus ne soient pas autocorrélés
  noautocorr <- 0
  while (noautocorr==0){
    cat(paste0("ADF with ",k, " lags: residuals OK? "))
    adf <- adfTest(series,lags=k,type=type)
    pvals <- Qtests(adf@test$lm$residuals,
                    24,
                    fitdf=length(adf@test$lm$coefficients))[,3]
    if (sum(pvals[24]<0.05,na.rm=T) == 0) {
      noautocorr <- 1; cat("OK \n")
    }else {
      cat("nope \n")
    }
    k <- k + 1
  }
  return(adf)
}

df1 <- adfTest_valid(spread,24,"ct")
df2 <- adfTest_valid2(spread,24,"ct")

# On teste ici le modèle
# ∆y_t = a + bt + γ y_t-1 +e_t
# tau3 correspond au test γ = 0
# phi2 correspond au test a = b = γ = 0
# phi3 correspond au test b = γ = 0
# voir https://new.mmf.lnu.edu.ua/wp-content/uploads/2018/03/enders_applied_econometric_time_series.pdf
summary(
  urca::ur.df(spread, type  = "trend",lags = 12,
            selectlags = "AIC")
  ) # 5 lags retenus par AIC

# Dans tous cas on ne rejette pas H0 (mais a priori pas de tendance linéaire)

# PP n'a pas besoin de beaucoup d'hypothèses parce que la stat calculée
# sur beta est construite de façon non paramétrique et qui corrige
# toute forme d'autocorrélation. Mais pas très bon quand peu de données
tseries::pp.test(spread) # on rejette pas hypothèse de présence de racine unitaire
tseries::kpss.test(spread, null = "Trend") # on rejette hypothèse de stationnarité

autoplot(dspread) / 
  (ggAcf(dspread) + labs(title = "ACF")  +
     ggPacf(dspread) + labs(title = "PACF") )

autoplot(spread) / 
  (ggAcf(spread) + labs(title = "ACF")  +
     ggPacf(spread) + labs(title = "PACF") )
tseries::pp.test(dspread) # on rejette pas hypothèse de présence de racine unitaire
tseries::kpss.test(dspread, null = "Level")
df1 <- adfTest_valid(dspread,24,"c")
df2 <- adfTest_valid2(dspread,24,"c")
summary(
  urca::ur.df(dspread, type  = "none",lags = 12,
            selectlags = "AIC")
)
   

##########################
####### Question 4 #######
##########################

autoplot(dspread) / 
  (ggAcf(dspread) + labs(title = "ACF")  +
     ggPacf(dspread) + labs(title = "PACF") )

##########################
####### Question 5 #######
##########################

models_possibles <- expand.grid(p = c(0,1,2,3), d = 1, q = c(0, 1, 2, 3))

evaluation_model <- function(order, x = spread){
  # ici on utilise Arima plutôt que arima pour la fonction accuracy
  model <- forecast::Arima(x, order = order,include.constant = FALSE)
  qualite <- c(AIC(model), BIC(model), accuracy(model))
  names(qualite) <- c("AIC", "BIC", colnames(accuracy(model)))
  qualite
}

all_models <- data.frame(t(apply(models_possibles,1,evaluation_model)))
rownames (all_models) <- sprintf("ARIMA(%i,%i,%i)", models_possibles[,"p"],
                                 models_possibles[,"d"], models_possibles[,"q"])
all_models

rownames(all_models)[which.min(all_models$AIC)]
rownames(all_models)[which.min(all_models$BIC)]
rownames(all_models)[which.min(all_models$RMSE)]
apply(all_models,2,function(x) rownames(all_models)[which.min(x)])


##########################
####### Question 6 #######
##########################

# On peut retenir les deux modèles qui minimises AIC et BIC
# Rmq : le modèle retenu par auto.arima est un ARIMA(2,1,2) qui ne minimise pas l'AIC
auto.arima(spread,max.D = 0, max.P = 0, max.Q = 0)

arima310 <- arima(spread,c(3,1,0),include.mean=FALSE)
arima011 <- arima(spread,c(0,1,1),include.mean=FALSE)
lmtest::coeftest(
  arima310
) # modèle bien ajusté coef AR(3) significatif
lmtest::coeftest(
  arima011
) # modèle bien ajusté coef MA(1) significatif


##########################
####### Question 7 #######
##########################

Qtests(residuals(
  arima310
),
fitdf = 3)

Qtests(residuals(
  arima011
),
fitdf = 3)

##########################
####### Question 9 #######
##########################

(autoplot(residuals(arima310)) +
   geom_vline(xintercept = 2001+11/12,linetype="dashed",
              col = "red", alpha = 0.7) + 
   labs(title = "ARIMA(3,1,0)")) /
  (autoplot(residuals(arima011)) +
     geom_vline(xintercept = 2001+11/12,linetype="dashed",
                col = "red", alpha = 0.7)+ 
     labs(title = "ARIMA(0,1,1)"))
# Il y a vraisemblablement un point atypique

arima310_ind <- arima(spread,c(3,1,0),include.mean=FALSE,xreg = time(spread) == 2001+11/12)
arima011_ind <- arima(spread,c(0,1,1),include.mean=FALSE,xreg = time(spread) == 2001+11/12)

# L'indicatrice est significative
lmtest::coeftest(
  arima310_ind
) # modèle bien ajusté coef AR(3) significatif
lmtest::coeftest(
  arima011_ind
)

(autoplot(residuals(arima310_ind)) +
    geom_vline(xintercept = 2001+11/12,linetype="dashed",
               col = "red", alpha = 0.7) + 
    labs(title = "ARIMA(3,1,0)")) /
  (autoplot(residuals(arima011_ind)) +
     geom_vline(xintercept = 2001+11/12,linetype="dashed",
                col = "red", alpha = 0.7)+ 
     labs(title = "ARIMA(0,1,1)"))

##########################
####### Question 10 #######
##########################

# On peut faire un test de chow
# Voir https://cran.r-project.org/web/packages/strucchange/vignettes/strucchange-intro.pdf
# Voir également https://robjhyndman.com/hyndsight/structural-breaks/
# Code à vérifier
test_rupture <- function(order, date_break = 1995){
  glob_mod = arima(spread,
                   order = order, include.mean = FALSE)
  rss <- sum(residuals(glob_mod)^2)
  sigma2 <- glob_mod$sigma2
  k <- length(coef(glob_mod))
  n <- length(spread) - order[2]
  fit1 <- arima(window(spread, end = date_break),
                order = order, include.mean = FALSE)
  fit2 <- arima(window(spread, start = date_break+1/12),
                order = order, include.mean = FALSE)
  ess <- sum(c(residuals(fit1), residuals(fit2))^2)
  stats <- (rss - ess)/(n-2*k)
  stats <- stats/k
  c(stats = stats,
    qf = qf(0.05, df1 = k, df2 = n-2*k, lower.tail = FALSE),
    pval = 1- pf(stats, df1 = k, df2 = n-2*k)
  )
}

round(test_rupture(order = c(0,1,1),date_break = 2001+11/12), 3)
round(test_rupture(order = c(3,1,0),date_break = 2001+11/12), 3)

#############################
####### TP avec fable #######
#############################
library(fable)
library(lubridate)
library(dplyr)
library(feasts)
library(ggplot2)

fable_mod = lapply(sprintf("(value) ~ 0 + pdq(%i,%i,%i) + PDQ(0,0,0) ", models_possibles[,"p"],
                           models_possibles[,"d"], models_possibles[,"q"]), as.formula)
fable_mod = lapply(fable_mod, ARIMA)
names(fable_mod) <- rownames (all_models)
spread_ts = spread %>% 
  as_tsibble()
all_mod = do.call(function (...) model(spread_ts, ...), fable_mod)

all_mod %>%
  report() 

all_mod %>%
  report() %>% 
  mutate(across(AIC:BIC, ~ .model[which.min(.x)])) %>% 
  distinct(AIC, AICc, BIC)
